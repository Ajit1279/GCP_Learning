- Reference: https://www.youtube.com/watch?v=uGcDt7iNFkE&list=PLl4APkPHzsUUOkOv3i62UidrLmSB8DcGC&index=24
- https://www.youtube.com/watch?v=DswQe7shSa4&list=PLl4APkPHzsUUOkOv3i62UidrLmSB8DcGC&index=25

- Basics:
  - In pervious lesson, we only set the authentication (certificates) for the user (Newadmin)
  - In this lesson, we'll set-up his authorization for him to be able to access the resources
  - There are series of commands (in the demo below) which we'll have to run to check the access levels
  - The yaml contains **"rules"** instead of specs. Within rules, we've
    - **apiGroup:** It can be inferred from the apiVersion tag of the yaml. if it's only v1, it's a core group, but in few cases it contains additional group (e.g. rbac.authorization.k8s.io/v1).
    - **resources:** Any of the kubernetes objects like pods, nodes, clusters etc.
    - **verb:** Type of access we want to grant


       ![image](https://github.com/user-attachments/assets/9d2290d3-04e7-4fe6-b924-079772d5b416)

  - There are few roles which are cluster level

     ![image](https://github.com/user-attachments/assets/c647d946-261a-4a67-932b-0d26b4aab1f7)

  - Please also note that **non-cluster roles** which are **not limited to particular namespace** are also **considered cluster roles**
      
 -----------------------------------------------------------------------
 - Demo
   - As a pre-requisites, follow [steps to set-up the TLS Certificate](https://github.com/Ajit1279/GCP_Learning/blob/main/Docker_K8S/K8S/concepts/241018_TLSCerts_in_K8S.md) for new user
  
   - Retrieve the certificate from CSR:

          sudo kubectl get csr/newadmin -o yaml

   - Export the issued certificate from CSR

          sudo kubectl get csr newadmin -o jsonpath='{.status.certificate}'| base64 -d > newadmin.crt

   - Create [role.yaml](https://github.com/Ajit1279/GCP_Learning/blob/main/Docker_K8S/K8S/concepts/role.yaml) for **creating a role**

   - There are two types of roles in API, i) Core group: If in the apiVersion, there's nothing after version (v1,v2 etc.), then it's core group ii) named group: The rbac yaml contains rbac.authorization.k8s.io/v1. These are named groups 

   - Let's apply this yaml

          sudo kubectl apply -f role.yaml
          sudo kubectl get roles
          sudo kubectl describe role pod-reader

      ![image](https://github.com/user-attachments/assets/002fc5dd-c1a2-4eef-9a46-dd6b653d42ed)


   - We'll create "Role Binding to bind these roles with the users. Please create [binding.yaml](https://github.com/Ajit1279/GCP_Learning/blob/main/Docker_K8S/K8S/concepts/binding.yaml)

          vi binding.yaml
          sudo kubectl apply -f binding.yaml
          sudo kubectl get rolebinding
          sudo kubectl describe rolebinding read-pods

     ![image](https://github.com/user-attachments/assets/3e7b2663-8f37-4410-b60d-4aaf1f0dcda1)


   - Now check if the user has access to get pods

         sudo kubectl auth can-i get pod --as newadmin

      ![image](https://github.com/user-attachments/assets/8cfbb989-6d9c-4848-b853-b75dc0fa8c47)

   - Now we'll have to login as user and run few commands

         
   -   
